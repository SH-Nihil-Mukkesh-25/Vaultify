<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vaultify Security Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-6">
  <h1 class="text-2xl font-bold mb-4">Vaultify Security Dashboard</h1>

  <div id="stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <!-- Stats cards injected here -->
  </div>

  <div class="flex gap-4 mb-4">
    <select id="eventFilter" class="p-2 border rounded">
      <option value="all">All Events</option>
      <option value="scan">Scan</option>
      <option value="alert">Alert</option>
      <option value="door">Door Operation</option>
    </select>

    <select id="limitFilter" class="p-2 border rounded">
      <option value="10">Last 10</option>
      <option value="25">Last 25</option>
      <option value="50">Last 50</option>
    </select>

    <button id="refreshBtn" class="px-3 py-2 bg-blue-500 text-white rounded">Refresh</button>
    <button id="autoRefreshBtn" class="px-3 py-2 bg-gray-500 text-white rounded">Auto Refresh: OFF</button>
    <button id="clearLogsBtn" class="px-3 py-2 bg-red-500 text-white rounded">Clear Logs</button>
  </div>

  <div id="logs" class="border rounded p-4 bg-white shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">Event Logs</h2>
    <ul id="logList" class="space-y-2"></ul>
  </div>

  <div class="border rounded p-4 bg-white shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">AI Security Insights</h2>
    <p id="aiSummary">Loading summary...</p>
  </div>

  <div class="border rounded p-4 bg-white shadow">
    <h2 class="text-lg font-semibold mb-2">Ask Security AI</h2>
    <div class="flex gap-2 mb-2">
      <input id="questionInput" type="text" placeholder="Ask a question..." class="flex-1 p-2 border rounded" />
      <button id="askBtn" class="px-3 py-2 bg-green-500 text-white rounded">Ask</button>
    </div>
    <p id="aiAnswer"></p>
  </div>

  <script>
    const BACKEND_URL = "https://vaultify-6rbk.onrender.com";

    const logList = document.getElementById("logList");
    const statsDiv = document.getElementById("stats");
    const aiSummary = document.getElementById("aiSummary");
    const aiAnswer = document.getElementById("aiAnswer");
    const refreshBtn = document.getElementById("refreshBtn");
    const autoRefreshBtn = document.getElementById("autoRefreshBtn");
    const clearLogsBtn = document.getElementById("clearLogsBtn");
    const eventFilter = document.getElementById("eventFilter");
    const limitFilter = document.getElementById("limitFilter");
    const questionInput = document.getElementById("questionInput");
    const askBtn = document.getElementById("askBtn");

    let autoRefresh = false;
    let intervalId = null;

    async function fetchLogs() {
      const type = eventFilter.value;
      const limit = limitFilter.value;
      const res = await fetch(`${BACKEND_URL}/logs?limit=${limit}&type=${type}`);
      const logs = await res.json();
      logList.innerHTML = "";
      logs.forEach(l => {
        const li = document.createElement("li");
        li.textContent = `[${l.timestamp}] ${l.event_type.toUpperCase()} - ${l.message}`;
        logList.appendChild(li);
      });
    }

    async function fetchStats() {
      const res = await fetch(`${BACKEND_URL}/stats`);
      const stats = await res.json();
      statsDiv.innerHTML = `
        <div class="p-4 bg-white shadow rounded text-center"><p class="text-sm">Total Logs</p><p class="text-xl font-bold">${stats.total_logs}</p></div>
        <div class="p-4 bg-white shadow rounded text-center"><p class="text-sm">Event Types</p><p class="text-xl font-bold">${Object.keys(stats.event_types).length}</p></div>
        <div class="p-4 bg-white shadow rounded text-center"><p class="text-sm">Alerts</p><p class="text-xl font-bold">${stats.alerts}</p></div>
        <div class="p-4 bg-white shadow rounded text-center"><p class="text-sm">Door Ops</p><p class="text-xl font-bold">${stats.door_operations}</p></div>
      `;
    }

    async function fetchSummary() {
      const res = await fetch(`${BACKEND_URL}/summary`);
      const data = await res.json();
      aiSummary.textContent = data.summary || "No summary available.";
    }

    async function askQuestion() {
      const q = questionInput.value.trim();
      if (!q) return;
      aiAnswer.textContent = "Thinking...";
      const res = await fetch(`${BACKEND_URL}/ask`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: q })
      });
      const data = await res.json();
      aiAnswer.textContent = data.answer || "No answer available.";
    }

    async function clearAllLogs() {
      await fetch(`${BACKEND_URL}/clear-logs`, { method: "POST" });
      await fetchLogs();
      await fetchStats();
    }

    refreshBtn.addEventListener("click", () => {
      fetchLogs();
      fetchStats();
      fetchSummary();
    });

    autoRefreshBtn.addEventListener("click", () => {
      autoRefresh = !autoRefresh;
      autoRefreshBtn.textContent = `Auto Refresh: ${autoRefresh ? "ON" : "OFF"}`;
      if (autoRefresh) {
        intervalId = setInterval(() => {
          fetchLogs();
          fetchStats();
          fetchSummary();
        }, 5000);
      } else {
        clearInterval(intervalId);
      }
    });

    clearLogsBtn.addEventListener("click", clearAllLogs);
    askBtn.addEventListener("click", askQuestion);

    // Initial load
    fetchLogs();
    fetchStats();
    fetchSummary();
  </script>
</body>
</html>


<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vaultify Security Dashboard</title>
  <link rel="stylesheet" href="vaultify-styles.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }
    h1 { color: #222; }
    h2, h3 { margin-top: 20px; }
    #logs { max-height: 300px; overflow-y: auto; background: #fff; border: 1px solid #ccc; padding: 10px; }
    .log { padding: 5px; border-bottom: 1px solid #eee; }
    .motion_alert { color: red; font-weight: bold; }
    .door_unlocked { color: green; font-weight: bold; }
    .door_autolock { color: orange; font-weight: bold; }
    .rfid_invalid { color: darkred; font-weight: bold; }
    #ai-summary, #ai-answer { background: #fff; padding: 10px; border: 1px solid #ccc; min-height: 40px; }
    input { padding: 5px; width: 250px; }
    button { padding: 6px 10px; margin-left: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Vaultify Security Dashboard</h1>
  <h2 id="door-status">ðŸ”’ Door Status Unknown</h2>

  <h3>Event Logs</h3>
  <div id="logs">Loading logs...</div>

  <h3>AI Summary</h3>
  <div id="ai-summary">Loading summary...</div>

  <h3>Ask AI</h3>
  <input type="text" id="ai-question" placeholder="Ask about security events"/>
  <button onclick="askAI()">Ask AI</button>
  <div id="ai-answer">No answer yet.</div>

  <script>
    const BACKEND_URL = "https://vaultify-6rbk.onrender.com";
    const logsDiv = document.getElementById("logs");
    const summaryDiv = document.getElementById("ai-summary");
    const doorStatusDiv = document.getElementById("door-status");
    const aiAnswerDiv = document.getElementById("ai-answer");

    async function fetchLogs() {
      try {
        const res = await fetch(`${BACKEND_URL}/api/logs`);
        const data = await res.json();
        if (!data.logs || data.logs.length === 0) {
          logsDiv.innerHTML = "No logs available yet.";
          doorStatusDiv.innerText = "ðŸ”’ Door Status Unknown";
          return;
        }

        // Display logs
        logsDiv.innerHTML = data.logs.slice().reverse().map(log => {
          let cls = log.event.replace(/\s+/g, "_");
          return `<div class="log ${cls}"><strong>${log.event}</strong>: ${log.detail}</div>`;
        }).join("");

        // Update door status
        const lastDoorEvent = data.logs.slice().reverse().find(e => e.event.includes("door"));
        doorStatusDiv.innerText = lastDoorEvent ? `ðŸ”‘ ${lastDoorEvent.detail}` : "ðŸ”’ Door Status Unknown";

      } catch (err) {
        console.error(err);
        logsDiv.innerHTML = "Error fetching logs.";
      }
    }

    async function fetchSummary() {
      try {
        const res = await fetch(`${BACKEND_URL}/api/summary`);
        const data = await res.json();
        summaryDiv.innerText = data.summary || "No summary available yet.";
      } catch (err) {
        console.error(err);
        summaryDiv.innerText = "Error fetching summary.";
      }
    }

    async function askAI() {
      const question = document.getElementById("ai-question").value;
      if (!question) return;
      try {
        const res = await fetch(`${BACKEND_URL}/api/ask?question=${encodeURIComponent(question)}`);
        const data = await res.json();
        aiAnswerDiv.innerText = data.answer || "No answer yet.";
      } catch (err) {
        console.error(err);
        aiAnswerDiv.innerText = "Error getting AI response.";
      }
    }

    // Auto-refresh logs every 5s, summary every 10s
    setInterval(fetchLogs, 5000);
    setInterval(fetchSummary, 10000);

    // Initial fetch
    fetchLogs();
    fetchSummary();
  </script>
</body>
</html> -->
